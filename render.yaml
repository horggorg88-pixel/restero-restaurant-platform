services:
  # Основное приложение (Next.js + Laravel API)
  - type: web
    name: restero-restaurant-platform
    env: docker
    dockerfilePath: ./Dockerfile
    plan: starter
    region: oregon
    branch: main
    buildCommand: ""
    startCommand: ""
    ports:
      - port: 3000
        protocol: http
        pullRequestOptIn: true
      - port: 8000 # Порт для Laravel API
        protocol: http
        pullRequestOptIn: true
      - port: 3001 # Порт для React Admin
        protocol: http
        pullRequestOptIn: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: APP_ENV
        value: production
      - key: APP_KEY
        generateValue: true
      - key: DB_CONNECTION
        value: mysql
      - key: DB_HOST
        fromDatabase:
          name: restero-db
          property: host
      - key: DB_PORT
        value: 3306
      - key: DB_DATABASE
        fromDatabase:
          name: restero-db
          property: database
      - key: DB_USERNAME
        fromDatabase:
          name: restero-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: restero-db
          property: password
      - key: REDIS_HOST
        fromService:
          type: redis
          name: restero-redis
          property: host
      - key: REDIS_PORT
        value: 6379
      - key: CACHE_DRIVER
        value: redis
      - key: SESSION_DRIVER
        value: redis
      - key: NEXT_PUBLIC_API_URL
        value: https://restero-restaurant-platform.onrender.com
      - key: NEXTAUTH_URL
        value: https://restero-restaurant-platform.onrender.com
      - key: NEXTAUTH_SECRET
        generateValue: true
      - key: COMPOSER_IGNORE_PLATFORM_REQS
        value: 1
      - key: COMPOSER_ALLOW_SUPERUSER
        value: 1
      - key: COMPOSER_DISABLE_XDEBUG_WARN
        value: 1
      - key: VITE_BACKEND_API_URL
        value: https://restero-restaurant-platform.onrender.com:8000
      - key: VITE_PLATFORM_URL
        value: https://restero-restaurant-platform.onrender.com

databases:
  # MySQL база данных
  - name: restero-db
    databaseName: restero
    user: restero
    plan: starter

  # Redis для кеширования
  - name: restero-redis
    plan: starter
